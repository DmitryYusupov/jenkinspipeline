<pipeline>
    <release>true</release>

    <stages>
        <stage name="checkout">
            <label>Checkout</label>
            <configs>
                <gitconfig>
                    <url>https://github.com/DmitryYusupov/shop.git</url>
                    <branch>testing</branch>
                    <tag></tag>
                </gitconfig>
            </configs>
        </stage>

        <stage name="build">
            <label>Build</label>
            <commands>
                <command type="gradle" utility="gradle">
                    <value>clean build</value>
                </command>
                <!--                <command type="maven" utility="mvn">-->
                <!--                    <value>clean build</value>-->
                <!--                </command>-->
            </commands>
        </stage>

        <stage name="integrationTests">
            <label>Integration test</label>
            <commands>
                <command type="gradle" utility="gradle">
                    <value>integrationTest</value>
                </command>
                <!--                               <command type="maven" utility="mvn">-->
                <!--                                    <value>integrationTest</value>-->
                <!--                                </command>-->
            </commands>
        </stage>

        <stage name="dockerise">
            <label>Dockerise</label>
            <numberOfImagesToStore>3</numberOfImagesToStore>

            <configs>
                <accessConfig>
                    <login>DOCKER_USER_DEV</login>
                    <dokcerRegistryUrl>https://registry.hub.docker.com</dokcerRegistryUrl>
                </accessConfig>

                <buildImageConfig>
                    <dockerFileDir>./</dockerFileDir>
                    <imageName>my-image</imageName>
                    <tagPrefix>env1</tagPrefix>
                </buildImageConfig>

                <pushImageConfig>
                </pushImageConfig>
            </configs>
        </stage>
    </stages>
</pipeline>
